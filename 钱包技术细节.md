# 钱包技术细节

### 助记词词汇

助记词词汇是英文单词序列代表用作种子对应确定性钱包的随机数。（12~24个词）

### 创建助记词

1. 创建一个128到256位的随机序列（熵）
2. 提出SHA256哈希前几位（熵长/32），就可以创造一个随机序列的校验和
3. 将校验和添加到随机序列的末尾
4. 将序列划分为包含11位的不同部分
5. 将每个包含11位部分的值与一个已经预先定义2048个单词的字典做对应
6. 生成的有序单词组就是助记码

### 从助记词生成种子

助记词表示长度为128至256位的熵。通过使用秘钥延伸函数PBKDF2（Password-Based Key Derivation Function ）来导出较长的（512位）的种子。

1. PBKDF2秘钥延伸函数的第一个参数是生成的助记词

2. PBKDF2秘钥延伸函数的第二个参数是盐。由字符串常数“助记词”与可选的用户提供的密码字符串链接组成

3. PBKDF2使用HMAC-SHA512算法，使用2048次哈希来延伸助记符和盐参数，产生一个512位的值作为其最终输出。这个512位的值就是种子

   提示：秘钥延伸函数，使用2048次哈希是一种非常有效的保护，可以防止对助记词或者密码短语的暴力攻击。它使得攻击尝试非常昂贵（从计算角度），需要尝试超过几千个密码和助记词组合，而这样产生的种子数据是巨大的（2^512)。

   ### 可选密码短语

   如果没有使用密码短语，助记词是用常量字符串“助记词”构成的盐进行延伸，从任何给定的助记词产生一个特定的512位种子。风险：如果钱包所有者无行为能力或死亡，没有人知道密码，种子是无用的，所有存储在钱包中的资金都将永远丢失，相反，如果所有者将密码短语与种子备份在相同的地方，则违反了上述第二个因素的目的。

   ### 从种子创造HD钱包

   HD钱包从单个根种子（root seed)中创建，为128至256位的随机数。最常见的是，这个种子是从助记符产生的，如上一节所述。

   HD钱包的所有的确定性都衍生自这个根种子。任何兼容HD钱包的根种子也可重新创造整个HD钱包。所以简单的转移HD钱包的根种子就让HD钱包中所包含的成千上百万的秘钥被复制，存储导出以及导入。

   根种子输入到HMAC-SHA512算法中就可以得到一个可用来创造主私钥（m)(master private key)和主链代码（a master chain code)的哈希。主私钥（m)之后可以通过使用我们在本章先前看到的那个普通椭圆曲线过程生成相对应的主公钥（M）。链代码用于从母秘钥中创造子秘钥的那个函数中引入熵。

   ### 私有字秘钥的衍生

   分层确定性钱包使用CKD(child key derivation)函数去从母秘钥衍生出子秘钥。

   子秘钥衍生函数是基于单项哈希函数。这个函数结合了：

   一个母私钥或者公共钥匙（ECDSA未压缩健）

   一个叫链码（256bits）的种子

   一个索引号（32bits）

   母私钥-链码-以及索引号合并在一起用HMAC-SHA256函数散列之后可以产生512位的散列。所得的散列可被拆分为两部分。散列右半部分的256位可以给子链当链码。左半部分256位散列以及索引号码被加载在母私钥上来衍生子私钥。

   改变索引可以让我们延长母秘钥以及创造序列中的其他子秘钥。每一个母秘钥可以有2^31个子秘钥。2^31是整个2^32范围可用的一半，因为另一半是为特定类型的推到而保留的。

   提示：子秘钥、对应的公钥以及比特币地址都不能从随机创造的秘钥和地址中被区分出来。事实是他们所在的序列，在创造他们的HD钱包函数之外是不可见的。一旦被创造出来，他们就和正常密钥一样运行了。

   扩展密钥可以简单地被存储并且表示为简单的将256位密钥与256位链码所并联的512位序列。有两种扩展密钥。扩展的私钥是私钥以及链码的结合，它可被用来衍生子私钥（子私钥可以衍生子公钥）。公钥以及链码组成扩展公钥，它可以用来扩展子公钥。

   从扩展公钥衍生一个分支公钥的能力是很重要的，但牵扯一些风险。访问扩展公钥并不能得到访问子私钥的途径。但是，因为扩展公钥包含有链码，如果子私钥被知道或者泄露的话，链码就可以被用来衍生所有的其他子私钥。简单的泄露子私钥以及一个母链码，可以暴露所有的子秘钥。更糟糕的是，子私钥与母链码可以用来推断母私钥。

   ### HD钱包秘钥识别符（路径）

   母秘钥生成的第一个子秘钥是m/0.第一个公钥是M/0.第一个子秘钥的子秘钥就是m/0/1,以此类推

   



