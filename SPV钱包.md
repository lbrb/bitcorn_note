# SPV

### spv与轻钱包的区别

轻钱包仍需下载每个新区块的全部数据并进行解析，获取并本地存储与自身相关的交易数据，只是无须在本地保存全部数据而已。

SPV节点不需要下载新区块的全部数据，只需要保存区块头部信息即可。

### 区块链支付验证和区块链交易验证的区别。

区块链交易验证包括账户余额验证，双重支付判断等，通常由全节点来完成

区块链支付验证是判断该笔交易是否已经得到了区块链节点的共识验证，并得到了多少的确认数。

### SPV技术原理

在区块链中，区块信息主要包括区块大小、区块头、交易数量和交易信息四部分内容,其中

- 区块大小：固定80字节
- 区块头：版本号、前一区块的hash，区块中交易默克尔树的根哈希值、时间戳、难度、nonce

spv支付验证原理：

- 计算待验证支付的交易哈希值
- 节点从区块链网络上获取并存储最长链的所有区块头至本地
- 节点从区块链获取待验证支付对应的默克尔树哈希认证路径
- 根据哈希认证路径，计算默克尔树的根哈希值，将计算结果与本地区块头中的默克尔树的根哈希值进行比较，定位到包含待验证支付的区块
- 验证该区块的区块头是否已经包含在已知最长链中，如果包含则验证支付真实有效
- 根据该区块头所在的位置，确定该支付已经得到的确认数量

### 以太坊对SPV的功能进行了扩展

每个区块头，并非只包含一颗默克尔树，而是包含三颗默克尔树，

分别对应三种对象-默克尔交易树、默克尔收据树和默克尔状态树。

其中默克尔收据树和默克尔状态树是比特币等现有区块链系统没有的。

三颗默克尔树的分工如下：

- 默克尔交易树：保存交易信息，用于验证交易是否真实包含在区块链中
- 默克尔收据树：保存某个地址的历史事件实例，比如一个交易是否成功执行，一个众筹合约是否完成了目标等
- 默克尔状态树：保存了账户名称、账户余额等